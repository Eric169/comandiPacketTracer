//nei due router installo i pacchetti per la sicurezza
en
conf t
license boot module c2900 technology-package securityk9
yes

//poi salvo le configurazioni e reload
end
copy running-config startup-config

reload


//prima permetto il traffico tra le due reti
access-list 110 permit ip 192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255
//configuro i parametri per la policy identificati dal numero 10
crypto isakmp policy 10
//imposto cifratura aes
encryption aes
//metodo di autenticazione pre-share
authentication pre-share
//associo la policy a un gruppo
group 2
//Generata la policy configuro la chiave di crittografia condivisa con il router dall’altra parte della rete
R2 (la chiave sarà: cisco)
ex
crypto isakmp key cisco address 10.0.0.2
//definire il transform-set VPN-set che utilizzerà il protocollo ESP con cifratura di tipo 3des e autenticazione SHA
crypto ipsec transform-set VPN-SET esp-3des esp-sha-hmac
//genererò quindi una nuova map con numero sequenziale nel mio caso pari a 10 ed indicando che sarà utilizzato il protocollo ipsec-isakmp.
crypto map VPN-MMAP 10 ipsec-isakmp
//inserisco una descrizione, l’ip a cui è connessa la vpn, i match address, l'IP non è quello reale ma è quello che esce dal router lontano
description VPN connection to R2
set peer 11.0.0.2
set transform-set VPN-SET
match address 110
//Infine applica la map appena configurata all’interfaccia seriale di uscita del mio router R1
interface Serial0/3/0
crypto map VPN-MAP

//se voglio vedere la configurazione 
show crypto isakmp policy
//se voglio vedere la map
show crypto map